<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Synchronized YouTube Player</title>
</head>
<body>
  <h1>Synchronized YouTube Player</h1>
  <div id="player"></div>

  <button id="playBtn">Play</button>
  <button id="pauseBtn">Pause</button>
  <button id="stopBtn">Stop</button>

  <script src="https://www.youtube.com/iframe_api"></script>
  <script>
    let player;
    let ws = new WebSocket('wss://youtube-sync-szk9.onrender.com');

    function onYouTubeIframeAPIReady() {
      player = new YT.Player('player', {
        height: '360',
        width: '640',
        videoId: 'G7VVnx4GX6o', // replace with your video
        events: {
          'onReady': onPlayerReady
        }
      });
    }

    function onPlayerReady() {
      console.log("Player ready");

      // Handle incoming WebSocket messages
      ws.onmessage = (msg) => {
        const data = JSON.parse(msg.data);

        if (data.type === 'play') {
          player.seekTo(data.currentTime, true);
          player.playVideo();
        } else if (data.type === 'pause') {
          player.seekTo(data.currentTime, true);
          player.pauseVideo();
        } else if (data.type === 'stop') {
          player.stopVideo();
        } else if (data.type === 'sync') {
          // New client sync
          player.seekTo(data.state.currentTime, true);
          if (data.state.isPlaying) player.playVideo();
        }
      };

      // Button actions
      document.getElementById('playBtn').onclick = () => {
        const currentTime = player.getCurrentTime();
        ws.send(JSON.stringify({ type: 'play', currentTime }));
      };

      document.getElementById('pauseBtn').onclick = () => {
        const currentTime = player.getCurrentTime();
        ws.send(JSON.stringify({ type: 'pause', currentTime }));
      };

      document.getElementById('stopBtn').onclick = () => {
        ws.send(JSON.stringify({ type: 'stop' }));
      };
    }
  </script>
</body>
</html>
